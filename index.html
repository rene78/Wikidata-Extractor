<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Wikidata Extractor</title>
  <link rel="Shortcut Icon" href="./img/favicon.ico">
  <style>
    body {
      background-color: linen;
    }
	
    h2 {
      color: maroon;
    }
    textarea {
      max-width: 100%;
      height: 200px;
    }
	
    thead {
    background-color: #F0F8FF;
    }
	
    tbody {
    background-color: #F0F0F0;
    }
	
    .flex-container {
    display: flex;
      flex-wrap: wrap;
    }
	
    .flex-container > div {
      background-color: #f1f1f1;
      width: 400px;
      margin: 10px;
      text-align: center;
    }
	
    code {
      background-color: #eee;
      border: 1px solid #999;
      display: block;
      padding: 10px;
    }
	
	nav a {
	  display: block;
	  color: white;
	  background-color: #333;
	  text-align: center;
      padding: 14px 16px;
      text-decoration: none;
	  float: left;
	}
	
    nav a:hover:not(.active) {
        background-color: #111;
    }
    
    .active {
        background-color: #4CAF50;
    }
  </style>
</head>

<body>

<nav>
<a class="active" href="https://rene78.github.io/Wikidata-Extractor/">Wikidata-Extractor</a>
<a href="https://rene78.github.io/mapmask-geojson-converter/">Mapmask <=> GeoJSON Converter</a>
</nav>
<br>
<br>

<h1>Wikidata Extractor</h1>
<textarea id="textareabox" cols="120" rows="20" placeholder="Please paste your GeoJSON extracted from overpass turbo"></textarea> <br>
<input type="button" value="Create Mapshapes" onclick="createMapshapes()" />
<input type="button" value="Create overview table" onclick="createOverviewTable()" />

<p id="infotext"></p>
<p id="mapshapes"></p>

<details>
  <summary>Help & Forum</summary>
  <h3>Introduction</h3>
  <p>It is often very tedious to gather all Wikidata ID's in order to create a dynamic district map for Wikivoyage. The macro on this page can automate this task.<br>
  Example: To get all the districts of <a href="https://en.wikivoyage.org/wiki/Talk:Prague#Wikidata_items_for_dynamic_map">Prague</a> is just a matter of minutes with this tool.<br>
  <img src="./img/Example_Prague.jpg" alt="Example: Prague" style="width:100%;max-width:400px;height:auto;"><br>
  </p>
  <h3>Workflow</h3>
  <a title="How to picture" href="./img/How_to_pic.png" target="_blank"><img src="./img/How_to_pic_lowres.jpg" alt="How to picture" style="width:100%;max-width:400px;height:auto;border:2px solid red;"></a>
  <ol>
  <li>Go to <a href="http://overpass-turbo.eu/">Overpass turbo</a>
  <li>Enter search query (see below for a best practice and some examples)</li>
  <li>Click on Run</li>
  <li>Copy the whole GeoJSON code on the right side of the website</li>
  <li>Go back to this website and paste the GeoJSON into the textbox above</li>
  <li>Click on "Create Mapshapes" to get code, which can be directly pasted to Wikivoyage or "Create overview table" for a list of all districts</li>
  </ol>
  <h3>Best practice to define a query in overpass</h3>
  <p>Example</p>
  <code>
  [out:json][timeout:25];<br>
  area[admin_level=8][name=Praha]->.search;<br>
  (rel(area.search)[admin_level=10][wikidata=""];<br>
  );<br>
  out tags;
  </code>

  <ol>
    <li>Define "JSON" as the output format. Define a timeout to cancel the query after a certain amount of time (optional).</li>
    <li>Define an area, within which to search for districts. This area could be a city, municipality or country. The correct name of this area as stated in the OSM relation is very important. Thus go to OSM and enter the Name into the search field. Click on the result (e.g. <a href="https://www.openstreetmap.org/relation/439840">result for Prague</a>) and copy the value of "name" into your overpass query ("Praha" in the example above). Then search for "admin_level" in the same result and copy this one as well (optional. In the example above it is "8").</li>
    <li>Now by trial-and-error try "admin_level" larger than the one defined in the search field (in the example above results will show up with "admin_level=10"). Alternatively check the sub-districts in OSM and copy the value of "admin_level".</li>
  </ol>

  <h3>Overpass example queries</h3>
  <div class="flex-container">
    <div><img src="./img/Example_Prague.jpg" alt="Example: Prague" style="width:100%;max-width:400px;height:auto;">
	Subdistricts of Prague<br><a href="http://overpass-turbo.eu/s/APg" target="_blank">Overpass example</a></div>
    <div><img src="./img/Example_Slovakia.jpg" alt="Example: Slovakia" style="width:100%;max-width:400px;height:auto;">
	Subdistricts of Slovakia<br><a href="http://overpass-turbo.eu/s/APr" target="_blank">Overpass example</a>*</div>
    <div><img src="./img/Example_France.jpg" alt="Example: Slovakia" style="width:100%;max-width:400px;height:auto;">
	Subdistricts of France<br><a href="http://overpass-turbo.eu/s/ARU" target="_blank">Overpass example</a>*</div>
    <div><img src="./img/Example_Berlin_Level_9.jpg" alt="Example: Verwaltungsbezirke of Berlin" style="width:100%;max-width:400px;height:auto;">
	Verwaltungsbezirke of Berlin<br><a href="http://overpass-turbo.eu/s/ATs" target="_blank">Overpass example</a></div>
    <div><img src="./img/Example_Berlin_Level_10.jpg" alt="Example: Ortsteile of Berlin" style="width:100%;max-width:400px;height:auto;">
	Ortsteile of Berlin<br><a href="http://overpass-turbo.eu/s/ATt" target="_blank">Overpass example</a></div>
  </div>
 * Overpass queries on larger areas (i.e. whole countries) can take a considerable amount of time to compute. So be patient (and remove or increase the timeout value in your query).

  <h3>Improve</h3>
  <p>If you have ideas on how to make this tool better please head over to the <a href="https://github.com/rene78/Wikidata-Extractor">github page</a> and participate or leave a comment down below.</p>
 
  <h3>Discuss</h3>
  <div id="disqus_thread"></div>
  <script>
  
  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
  
  var disqus_config = function () {
  this.page.url = "https://rene78.github.io/Wikidata-Extractor/";  // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = 654187; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  };
  
  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://wikidata-extractor.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</details>

<script>
function createMapshapes() {
  var input = document.getElementById("textareabox").value;
  var myObj = JSON.parse(input);
  var mapshape="{{Mapframe|42|12|width=500|height=500|zoom=1|group=map1}}\r\n";
  for (var i = 0; i < myObj.elements.length; i++) {
    var wikidata = myObj.elements[i].tags.wikidata;
    var name = defineName(myObj,i);
    var randColor = ("000000" + Math.random().toString(16).slice(2, 8).toUpperCase()).slice(-6);//source: https://www.paulirish.com/2009/random-hex-color-code-snippets/
    mapshape=mapshape + "{{Mapshape|type=geoshape|wikidata=" + wikidata + "|group=map1|fill=#"    + randColor + "|title=" + name + " - " + wikidata + "}}\r\n";
    //document.getElementById("mapshapes").innerHTML = mapshape;
    //console.log("Name: " +name);
    //console.log("Wikidata: " +wikidata);
    //console.log("Color: " +randColor);
    //console.log(mapshape);
  }
  var outputTextarea = "<textarea id=textareabox cols=110 rows=30>" + mapshape + "</textarea>";
  document.getElementById("mapshapes").innerHTML=outputTextarea;
  document.getElementById("infotext").innerHTML="<h2>Result</h2><ul><li>Please change the Mapframe values for latitude (currently 42), longitude (currently 12) and zoom (currently 1) according to you needs</li></ul>In case of <i>Couldn't parse JSON: Syntax error</i>, when pasting in Wikivoyage:<ul><li>Check, if any of the Mapshapes below have the tag <i>wikidata</i> set to <i>undefined</i>. This means, that the Wikidata-ID has yet to be defined in OSM</li><li>Check if there are quotation marks in the title of any district. They are not allowed!</li></ul>";
  /*
  Alternative with DOM modification:
  var outputTextarea = document.createElement("TEXTAREA");
    outputTextarea.rows=30;
    outputTextarea.cols=110;
  var textnode = document.createTextNode(mapshape);
  outputTextarea.appendChild(textnode);
  document.getElementById("mapshapes").appendChild(outputTextarea);
  */
}
function createOverviewTable() {
  var table="<table>";
  table += "<thead>";
  table += "<tr>";
  table += "<th align=left>Name</th>";
  table += "<th align=left>Wikidata-ID</th>";
  table += "</tr>";
  table += "</thead>";
  table += "<tbody>";
  var input = document.getElementById("textareabox").value;
  var myObj = JSON.parse(input);
  for (var i = 0; i < myObj.elements.length; i++) {
    var wikidata = myObj.elements[i].tags.wikidata;
    var name = defineName(myObj,i);
    table += "<tr>";
    table += ("<td>" + name + "</td>");
    table += ("<td>" + wikidata + "</td>");
  }
  table += "</tr>";
  table += "</tbody>";
  table += "</table";
  //console.log(table);
  document.getElementById("mapshapes").innerHTML=table;
  document.getElementById("infotext").innerHTML="<h2>Result</h2>";
}
function defineName(myObj, i) {
//use english name, if available. Else use the normal "name" tag. Dot/bracket notation used due to colon (https://stackoverflow.com/q/4925760/5263954)
  if (typeof myObj.elements[i].tags['name:en'] == 'undefined') {
    return myObj.elements[i].tags.name;
  } else {
    return myObj.elements[i].tags['name:en'];
  }
}
</script>
<script id="dsq-count-scr" src="//wikidata-extractor.disqus.com/count.js" async></script>
</body>
</html>
